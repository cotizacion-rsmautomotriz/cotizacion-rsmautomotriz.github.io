{% extends "base.html" %}
{% block title %}Búsqueda por Fecha{% endblock %}
{% block content %}
<div class="cotizacion">
    <div class="container2">
        <form action="/search_by_date" method="POST">
            <div class="container2-a3">
                <label for="date">Ingrese la Fecha:</label>
                <input type="date" id="date" name="search_date" required>
            </div>
            <div class="container4">
                <button type="submit" class="button button-tree">Cargar</button>
                <a href="{{ url_for('main.dashboard') }}" class="button button-back">Volver</a>
            </div>
        </form>
    </div>
</div>

{% if products %}
<div class="container3">
    <h2>Repuestos del día {{ search_date }}</h2>
    <form action="/update_products" method="POST" id="edit-form">
        <input type="hidden" name="edit_date" value="{{ search_date }}">
        <table>
            <thead>
                <tr>
                    <th>Repuesto</th>
                    <th>Monto</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for product in products %}
                <tr>
                    <td>
                        <input type="text" name="names[]" value="{{ product.name }}" readonly class="edit-input" data-original="{{ product.name }}">
                    </td>
                    <td>
                        <input type="number" name="amounts[]" value="{{ product.amount }}" readonly class="edit-input" data-original="{{ product.amount }}">
                    </td>
                    <td>
                        <button type="button" class="btn-delete" style="display: none;">Borrar</button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        <div class="button-container">
            <button type="button" class="button button-edit" onclick="toggleEdit()">Editar</button>
            <button type="submit" class="button button-save" style="display: none;">Guardar Cambios</button>
        </div>
    </form>
    <div class="total">
        <strong>Total:</strong> ${{ total }}
    </div>
</div>
{% endif %}

{% if search_date %}
<div class="alert alert-info">
    Resultados para la fecha: {{ search_date }}
</div>
{% endif %}

{% with messages = get_flashed_messages() %}
    {% if messages %}
        {% for message in messages %}
            <div class="alert">{{ message }}</div>
        {% endfor %}
    {% endif %}
{% endwith %}
</div>

<style>
/* ... estilos existentes ... */
.btn-delete {
    background-color: #dc3545;
    color: white;
    border: none;
    padding: 5px 10px;
    border-radius: 3px;
    cursor: pointer;
}
</style>

<script>
function toggleEdit() {
    const inputs = document.querySelectorAll('.edit-input');
    const editButton = document.querySelector('.button-edit');
    const saveButton = document.querySelector('.button-save');
    const deleteButtons = document.querySelectorAll('.btn-delete');
    
    inputs.forEach(input => {
        input.readOnly = !input.readOnly;
    });
    
    if (editButton.textContent === 'Editar') {
        editButton.textContent = 'Cancelar';
        editButton.style.backgroundColor = '#dc3545';
        saveButton.style.display = 'block';
        
        // Mostrar botones de borrar
        deleteButtons.forEach(btn => {
            btn.style.display = 'block';
        });
    } else {
        editButton.textContent = 'Editar';
        editButton.style.backgroundColor = '#ffc107';
        saveButton.style.display = 'none';
        
        // Ocultar botones de borrar y restaurar valores originales
        deleteButtons.forEach(btn => {
            btn.style.display = 'none';
        });
        
        inputs.forEach(input => {
            input.value = input.getAttribute('data-original');
        });
        
        location.reload();
    }
}

document.addEventListener('DOMContentLoaded', function() {
    const table = document.querySelector('table tbody');
    
    table.addEventListener('click', function(event) {
        if (event.target.classList.contains('btn-delete')) {
            // Eliminar la fila cuando se hace clic en "Borrar"
            const row = event.target.closest('tr');
            row.style.display = 'none';
            
            // Agrega un input oculto para indicar que este producto debe ser eliminado
            const hiddenInput = document.createElement('input');
            hiddenInput.type = 'hidden';
            hiddenInput.name = 'deleted_names[]';
            hiddenInput.value = row.querySelector('input[name="names[]"]').value;
            document.getElementById('edit-form').appendChild(hiddenInput);
        }
    });
});    
</script>
{% endblock %}
});    
</script>

{% endblock %}
